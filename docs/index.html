<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salgssucces Dashboard - Din Profit Motor</title>

    <!-- Tailwind CSS CDN - OK for development/demo purposes -->
    <!-- For production, install Tailwind as PostCSS plugin: https://tailwindcss.com/docs/installation -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- PapaParse CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom styling -->
    <style>
        .drop-zone {
            border: 2px dashed #cbd5e0;
            transition: all 0.3s ease;
        }
        .drop-zone.dragover {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        .profit-positive {
            color: #38a169;
            font-weight: bold;
        }
        .profit-negative {
            color: #e53e3e;
            font-weight: bold;
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }

        /* Message modal styles */
        .message-modal-error #messageIcon {
            color: #dc2626;
        }
        .message-modal-warning #messageIcon {
            color: #d97706;
        }
        .message-modal-success #messageIcon {
            color: #16a34a;
        }
        .message-modal-info #messageIcon {
            color: #2563eb;
        }

        /* Empty state styles */
        .empty-state {
            padding: 3rem 1rem;
            text-align: center;
        }
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        .empty-state-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        .empty-state-description {
            color: #6b7280;
            font-size: 0.875rem;
            max-width: 20rem;
            margin: 0 auto 1rem auto;
        }
        .hidden {
            display: none;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #3498db;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Print styles */
        @media print {
            body {
                font-size: 12px;
                line-height: 1.4;
            }

            .no-print {
                display: none !important;
            }

            header {
                position: static;
                padding: 20px;
                border-bottom: 2px solid #000;
                margin-bottom: 20px;
            }

            .drop-zone, .hidden, .loading-overlay {
                display: none !important;
            }

            .table-container {
                max-height: none;
                overflow: visible;
            }

            table {
                font-size: 10px;
                width: 100%;
                border-collapse: collapse;
            }

            th, td {
                border: 1px solid #000;
                padding: 4px;
                text-align: left;
            }

            .bg-white {
                background: white !important;
                box-shadow: none !important;
                border: 1px solid #ccc !important;
            }

            .profit-positive {
                color: #000 !important;
                font-weight: bold;
            }

            .profit-negative {
                color: #000 !important;
                font-weight: bold;
            }

            .grid {
                display: block !important;
            }

            .grid > * {
                display: block !important;
                margin-bottom: 20px;
            }

            canvas {
                max-width: 100%;
                height: auto !important;
            }

            h1 {
                font-size: 24px;
                margin-bottom: 10px;
            }

            h2 {
                font-size: 18px;
                margin-bottom: 8px;
            }

            h3 {
                font-size: 16px;
                margin-bottom: 6px;
            }

            .text-3xl {
                font-size: 24px !important;
            }

            .text-xl {
                font-size: 18px !important;
            }

            .text-lg {
                font-size: 16px !important;
            }

            .p-6 {
                padding: 15px !important;
            }

            .mb-4 {
                margin-bottom: 10px !important;
            }

            .mb-6 {
                margin-bottom: 15px !important;
            }

        /* Mobile responsiveness improvements */
        @media (max-width: 768px) {
            .max-w-7xl {
                max-width: 100% !important;
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }

            /* Make tables horizontally scrollable on mobile */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 600px; /* Ensure tables don't get too cramped */
            }

            /* Improve button sizes for touch */
            .px-4 {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }

            .py-2 {
                padding-top: 0.75rem !important;
                padding-bottom: 0.75rem !important;
            }

            /* Stack grid items vertically on mobile */
            .md\:grid-cols-2 {
                grid-template-columns: 1fr !important;
            }

            .lg\:grid-cols-2 {
                grid-template-columns: 1fr !important;
            }

            .md\:grid-cols-3 {
                grid-template-columns: 1fr !important;
            }

            .lg\:grid-cols-4 {
                grid-template-columns: 1fr !important;
            }

            /* Improve modal on mobile */
            .max-w-md {
                max-width: calc(100vw - 2rem) !important;
                margin-left: 1rem !important;
                margin-right: 1rem !important;
            }

            /* Header improvements for mobile */
            header .flex {
                flex-direction: column;
                align-items: stretch !important;
                gap: 1rem;
            }

            header .flex.space-x-2 {
                justify-content: center;
                flex-wrap: wrap;
            }

            /* Improve filter layout on mobile */
            .md\:grid-cols-3 {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }

            /* Improve chart containers on mobile */
            canvas {
                max-width: 100% !important;
                height: auto !important;
            }
        }

        @media (max-width: 640px) {
            .text-3xl {
                font-size: 1.875rem !important;
            }

            .text-xl {
                font-size: 1.125rem !important;
            }

            .text-lg {
                font-size: 1rem !important;
            }

            /* Reduce padding on small screens */
            .p-6 {
                padding: 1rem !important;
            }

            .p-8 {
                padding: 1.5rem !important;
            }

            /* Stack comparison items */
            .lg\:grid-cols-2 {
                grid-template-columns: 1fr !important;
            }
        }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="bg-white rounded-lg p-8 shadow-xl max-w-md mx-4">
            <div class="text-center">
                <div class="spinner mx-auto mb-4"></div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Behandler data...</h3>
                <p id="loadingMessage" class="text-gray-600 text-sm mb-4">L√¶ser CSV-fil...</p>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div class="mt-3 text-xs text-gray-500">
                    <span id="progressText">0%</span> f√¶rdig
                </div>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg p-6 shadow-xl w-full max-w-md">
            <div class="text-center">
                <div id="messageIcon" class="mb-3">
                    <!-- Icon will be inserted here -->
                </div>
                <h3 id="messageTitle" class="text-lg font-semibold text-gray-900 mb-3">Besked</h3>
                <p id="messageText" class="text-gray-600 text-sm mb-6">Besked tekst</p>
                <button id="messageCloseBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition-colors font-medium">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 shadow-lg border-b no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-4 lg:gap-0">
                <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4 text-center lg:text-left">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-2xl">üí∞</span>
                    </div>
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold text-white">üöÄ Salgssucces Dashboard</h1>
                        <p class="text-blue-100 text-sm">Din vej til maksimal profit</p>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row items-center gap-4 w-full lg:w-auto">
                    <!-- Global Search -->
                    <div id="globalSearchContainer" class="hidden relative w-full sm:w-80">
                        <input type="text" id="globalSearch" placeholder="S√∏g efter produkter..." class="w-full pl-10 pr-4 py-2 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-blue-100 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 backdrop-blur-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-blue-100">üîç</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-wrap justify-center gap-2">
                        <button id="toggleSearchBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-2 rounded-lg transition-all duration-200 backdrop-blur-sm border border-white border-opacity-20" title="Global s√∏gning">
                            üîç
                        </button>
                        <button id="printBtn" class="hidden bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 sm:px-4 py-2 rounded-lg transition-all duration-200 backdrop-blur-sm border border-white border-opacity-20">
                            üñ®Ô∏è Udskriv
                        </button>
                        <button id="compareBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 sm:px-4 py-2 rounded-lg transition-all duration-200 backdrop-blur-sm border border-white border-opacity-20">
                            üìä
                        </button>
                        <button id="clearBtn" class="hidden bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 sm:px-4 py-2 rounded-lg transition-all duration-200 backdrop-blur-sm border border-white border-opacity-20">
                            üîÑ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Bar -->
    <nav id="navBar" class="hidden bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between py-3">
                <div class="flex items-center space-x-1 sm:space-x-4 overflow-x-auto">
                    <a href="#stats" class="nav-link whitespace-nowrap px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors" data-section="stats">
                        üìä Oversigt
                    </a>
                    <a href="#visualizations" class="nav-link whitespace-nowrap px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors" data-section="visualizations">
                        üìà Visualiseringer
                    </a>
                    <a href="#filters" class="nav-link whitespace-nowrap px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors" data-section="filters">
                        üîç Filtre
                    </a>
                    <a href="#favorites" class="nav-link whitespace-nowrap px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors hidden" data-section="favorites">
                        ‚≠ê Favoritter
                    </a>
                    <a href="#cashCows" class="nav-link whitespace-nowrap px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors" data-section="cashCows">
                        üêÆ Cash Cows
                    </a>
                    <a href="#lagerGuld" class="nav-link whitespace-nowrap px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors" data-section="lagerGuld">
                        üì¶ Lager-Guld
                    </a>
                    <a href="#tabs" class="nav-link whitespace-nowrap px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors" data-section="tabs">
                        ‚ö†Ô∏è Tabs-listen
                    </a>
                </div>
                <div class="hidden sm:block">
                    <span id="navStatus" class="text-xs text-gray-500"></span>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- File Upload Zone -->
        <div id="uploadZone" class="drop-zone bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl p-12 text-center mb-8 border-2 border-dashed border-blue-300 hover:border-blue-400 transition-colors duration-300">
            <div class="mb-6">
                <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mx-auto flex items-center justify-center mb-4">
                    <span class="text-3xl text-white">üöÄ</span>
                </div>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-3">Start Din Profit Jagt!</h3>
            <p class="text-gray-600 mb-6 text-lg">Upload din icast.csv og f√• √∏jeblikkelig indsigt i dine bedste salgsmuligheder</p>
            <input type="file" id="fileInput" accept=".csv" class="hidden">
            <button onclick="document.getElementById('fileInput').click()" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 py-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                üìÅ V√¶lg Din Salgsdata
            </button>
            <p class="text-sm text-gray-500 mt-4">eller tr√¶k og slip filen her</p>
        </div>

        <!-- Dashboard Sections -->
        <div id="dashboard" class="hidden space-y-8">

            <!-- Statistics Overview Section -->
            <div id="stats" class="bg-white rounded-xl shadow-lg border border-gray-200 p-8 hover:shadow-xl transition-shadow duration-300">
                <div class="flex items-center mb-8">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-white text-xl">üìä</span>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">üí™ Din Salgsperformance</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white hover:scale-105 transition-transform duration-200 shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-blue-100 text-sm font-medium">Produkt Portef√∏lje</span>
                            <span class="text-2xl">üì¶</span>
                        </div>
                        <div class="text-3xl font-bold mb-1" id="totalProducts">0</div>
                        <div class="text-blue-100 text-xs">aktive produkter</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-6 rounded-xl text-white hover:scale-105 transition-transform duration-200 shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-green-100 text-sm font-medium">Profit Maskine</span>
                            <span class="text-2xl">üí∞</span>
                        </div>
                        <div class="text-3xl font-bold mb-1" id="totalProfit">0,00 kr</div>
                        <div class="text-green-100 text-xs">total fortjeneste</div>
                    </div>
                    <div class="bg-gradient-to-br from-amber-500 to-orange-600 p-6 rounded-xl text-white hover:scale-105 transition-transform duration-200 shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-amber-100 text-sm font-medium">Gns. Profit pr. Produkt</span>
                            <span class="text-2xl">üìà</span>
                        </div>
                        <div class="text-3xl font-bold mb-1" id="avgProfit">0,00 kr</div>
                        <div class="text-amber-100 text-xs">gennemsnitlig margin</div>
                    </div>
                    <div class="bg-gradient-to-br from-red-500 to-rose-600 p-6 rounded-xl text-white hover:scale-105 transition-transform duration-200 shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-red-100 text-sm font-medium">Advarselsflag</span>
                            <span class="text-2xl">‚ö†Ô∏è</span>
                        </div>
                        <div class="text-3xl font-bold mb-1" id="lossProducts">0</div>
                        <div class="text-red-100 text-xs">tabsgivende varer</div>
                    </div>
                </div>
            </div>

            <!-- Visualizations Section -->
            <div id="visualizations" class="bg-white rounded-lg shadow-sm border p-6">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-white text-lg">üìä</span>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900">üî• Salgsindsigt & Trends</h2>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Profit fordeling</h3>
                        <canvas id="profitChart" width="400" height="300"></canvas>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Lager status</h3>
                        <canvas id="inventoryChart" width="400" height="300"></canvas>
                    </div>
                </div>
            </div>

            <!-- Advanced Filters Section -->
            <div id="filters" class="bg-white rounded-lg shadow-sm border p-6 no-print">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-white text-lg">üéØ</span>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900">Pr√¶cisions Filtrering</h2>
                    <button id="resetFiltersBtn" class="ml-auto bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-4 py-2 rounded-lg text-sm transition-all duration-200 shadow-md">üîÑ Nulstil filtre</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Lagerantal (min-max)</label>
                        <div class="flex space-x-2">
                            <input type="number" id="minLagerantal" placeholder="Min" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <input type="number" id="maxLagerantal" placeholder="Max" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">üí∞ Profit niveau</label>
                        <div class="flex space-x-2">
                            <input type="number" id="minFortjeneste" placeholder="Min kr" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <input type="number" id="maxFortjeneste" placeholder="Max kr" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">üè∑Ô∏è Produkt type</label>
                        <select id="productCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Alle kategorier</option>
                            <option value="mad">Mad & Drikke</option>
                            <option value="elektronik">Elektronik</option>
                            <option value="toj">T√∏j & Accessories</option>
                            <option value="husholdning">Husholdning</option>
                            <option value="andre">Andre</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Favorites Section -->
            <div id="favoritesSection" class="bg-white rounded-lg shadow-sm border p-6 hidden">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-white text-lg">‚≠ê</span>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900">üåü Mine Top Prioriteter</h2>
                    </div>
                    <button id="clearFavoritesBtn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-md text-sm transition-colors">Ryd favoritter</button>
                </div>
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Varekode</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Varenavn</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lagerantal</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fortjeneste</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Handlinger</th>
                            </tr>
                        </thead>
                        <tbody id="favoritesTable" class="bg-white divide-y divide-gray-200">
                            <!-- Favorites will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Cash Cows Section -->
            <div id="cashCows" class="bg-white rounded-lg shadow-sm border p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-white text-lg">üíé</span>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900">üíé Guldminerne - Din Profit Motor</h2>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="cashCowsSearch" placeholder="üîç Find dine bedste profitmaskiner..." class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button id="exportCashCowsBtn" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-4 py-2 rounded-lg text-sm transition-all duration-200 shadow-md hover:shadow-lg">üíæ Eksporter Top Produkter</button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Varekode</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Varenavn</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lagerantal</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fortjeneste</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Favorit</th>
                            </tr>
                        </thead>
                        <tbody id="cashCowsTable" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Lager-Guld Section -->
            <div id="lagerGuld" class="bg-white rounded-lg shadow-sm border p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-amber-500 to-yellow-600 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-white text-lg">üèÜ</span>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900">üèÜ Lager-Guld - Salg NU!</h2>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="lagerGuldSearch" placeholder="üîç Find dine hurtige salg..." class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button id="exportLagerGuldBtn" class="bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white px-4 py-2 rounded-lg text-sm transition-all duration-200 shadow-md hover:shadow-lg">üí∞ Eksporter Salgsmuligheder</button>
                    </div>
                </div>
                <p class="text-sm text-gray-600 mb-4">üí∞ Varer klar til √∏jeblikkelig oms√¶tning - din nemme profit!</p>
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Varekode</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Varenavn</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lagerantal</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fortjeneste</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Favorit</th>
                            </tr>
                        </thead>
                        <tbody id="lagerGuldTable" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tabs-listen Section -->
            <div id="tabs" class="bg-white rounded-lg shadow-sm border p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-red-500 to-rose-600 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-white text-lg">üö®</span>
                        </div>
                        <h2 class="text-xl font-semibold text-gray-900">üö® Farezonen - Handlingskr√¶vende!</h2>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="tabsSearch" placeholder="S√∏g efter produkter..." class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button id="exportTabsBtn" class="bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white px-4 py-2 rounded-lg text-sm transition-all duration-200 shadow-md hover:shadow-lg">üö® Eksporter Problemliste</button>
                    </div>
                </div>
                <p class="text-sm text-gray-600 mb-4">üî• Kritisk! Disse varer koster dig penge - handle NU!</p>
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Varekode</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Varenavn</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lagerantal</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fortjeneste</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Favorit</th>
                            </tr>
                        </thead>
                        <tbody id="tabsTable" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Comparison Mode -->
        <div id="comparisonMode" class="hidden space-y-8">
            <div class="bg-white rounded-lg shadow-sm border p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-semibold text-gray-900">Sammenligning af to perioder</h2>
                    <button id="exitCompareBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">Tilbage til enkelt analyse</button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- File 1 -->
                    <div class="border rounded-lg p-4">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Periode 1</h3>
                        <div id="file1DropZone" class="drop-zone bg-gray-50 rounded-lg p-6 text-center mb-4">
                            <div class="mb-2">
                                <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">Upload f√∏rste CSV-fil</p>
                            <input type="file" id="file1Input" accept=".csv" class="hidden">
                            <button onclick="document.getElementById('file1Input').click()" class="text-blue-500 hover:text-blue-600 text-sm underline">V√¶lg fil</button>
                        </div>
                        <div id="file1Stats" class="hidden space-y-2 text-sm">
                            <div class="flex justify-between"><span>Produkter:</span> <span id="file1Products">0</span></div>
                            <div class="flex justify-between"><span>Total fortjeneste:</span> <span id="file1Profit">0,00 kr</span></div>
                            <div class="flex justify-between"><span>Cash Cows:</span> <span id="file1CashCows">0</span></div>
                        </div>
                    </div>

                    <!-- File 2 -->
                    <div class="border rounded-lg p-4">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Periode 2</h3>
                        <div id="file2DropZone" class="drop-zone bg-gray-50 rounded-lg p-6 text-center mb-4">
                            <div class="mb-2">
                                <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">Upload anden CSV-fil</p>
                            <input type="file" id="file2Input" accept=".csv" class="hidden">
                            <button onclick="document.getElementById('file2Input').click()" class="text-blue-500 hover:text-blue-600 text-sm underline">V√¶lg fil</button>
                        </div>
                        <div id="file2Stats" class="hidden space-y-2 text-sm">
                            <div class="flex justify-between"><span>Produkter:</span> <span id="file2Products">0</span></div>
                            <div class="flex justify-between"><span>Total fortjeneste:</span> <span id="file2Profit">0,00 kr</span></div>
                            <div class="flex justify-between"><span>Cash Cows:</span> <span id="file2CashCows">0</span></div>
                        </div>
                    </div>
                </div>

                <!-- Comparison Results -->
                <div id="comparisonResults" class="hidden mt-8">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Sammenligning</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <div class="text-sm text-green-600 font-medium">Fortjeneste forskel</div>
                            <div class="text-xl font-bold text-green-900" id="profitDifference">0,00 kr</div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <div class="text-sm text-blue-600 font-medium">Nye produkter</div>
                            <div class="text-xl font-bold text-blue-900" id="newProducts">0</div>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg text-center">
                            <div class="text-sm text-yellow-600 font-medium">Forbedrede produkter</div>
                            <div class="text-xl font-bold text-yellow-900" id="improvedProducts">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let salesData = [];
        let filteredSalesData = [];
        let cashCowsData = [];
        let lagerGuldData = [];
        let tabsData = [];

        // Comparison variables
        let file1Data = [];
        let file2Data = [];
        let isComparisonMode = false;

        // Chart variables
        let profitChart = null;
        let inventoryChart = null;

        // Local storage keys
        const STORAGE_KEYS = {
            SALES_DATA: 'salgsanalyse_salesData',
            FILTERED_DATA: 'salgsanalyse_filteredData',
            FILE_NAME: 'salgsanalyse_fileName',
            LAST_UPDATED: 'salgsanalyse_lastUpdated',
            FAVORITES: 'salgsanalyse_favorites'
        };

        // Favorites data
        let favorites = new Set();

        // DOM elements
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const dashboard = document.getElementById('dashboard');
        const clearBtn = document.getElementById('clearBtn');
        const cashCowsTable = document.getElementById('cashCowsTable');
        const lagerGuldTable = document.getElementById('lagerGuldTable');
        const tabsTable = document.getElementById('tabsTable');
        const cashCowsSearch = document.getElementById('cashCowsSearch');
        const lagerGuldSearch = document.getElementById('lagerGuldSearch');
        const tabsSearch = document.getElementById('tabsSearch');
        const exportCashCowsBtn = document.getElementById('exportCashCowsBtn');
        const exportLagerGuldBtn = document.getElementById('exportLagerGuldBtn');
        const exportTabsBtn = document.getElementById('exportTabsBtn');
        const totalProductsEl = document.getElementById('totalProducts');
        const totalProfitEl = document.getElementById('totalProfit');
        const avgProfitEl = document.getElementById('avgProfit');
        const lossProductsEl = document.getElementById('lossProducts');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        const minLagerantal = document.getElementById('minLagerantal');
        const maxLagerantal = document.getElementById('maxLagerantal');
        const minFortjeneste = document.getElementById('minFortjeneste');
        const maxFortjeneste = document.getElementById('maxFortjeneste');
        const productCategory = document.getElementById('productCategory');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const progressFill = document.getElementById('progressFill');
        const compareBtn = document.getElementById('compareBtn');
        const printBtn = document.getElementById('printBtn');
        const comparisonMode = document.getElementById('comparisonMode');
        const exitCompareBtn = document.getElementById('exitCompareBtn');
        const file1Input = document.getElementById('file1Input');
        const file2Input = document.getElementById('file2Input');
        const file1DropZone = document.getElementById('file1DropZone');
        const file2DropZone = document.getElementById('file2DropZone');
        const file1Stats = document.getElementById('file1Stats');
        const file2Stats = document.getElementById('file2Stats');
        const comparisonResults = document.getElementById('comparisonResults');
        const profitDifference = document.getElementById('profitDifference');
        const newProducts = document.getElementById('newProducts');
        const improvedProducts = document.getElementById('improvedProducts');
        const file1Products = document.getElementById('file1Products');
        const file2Products = document.getElementById('file2Products');
        const file1Profit = document.getElementById('file1Profit');
        const file2Profit = document.getElementById('file2Profit');
        const file1CashCows = document.getElementById('file1CashCows');
        const file2CashCows = document.getElementById('file2CashCows');
        const profitChartCanvas = document.getElementById('profitChart');
        const inventoryChartCanvas = document.getElementById('inventoryChart');
        const favoritesSection = document.getElementById('favoritesSection');
        const favoritesTable = document.getElementById('favoritesTable');
        const clearFavoritesBtn = document.getElementById('clearFavoritesBtn');
        const messageModal = document.getElementById('messageModal');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const messageIcon = document.getElementById('messageIcon');
        const messageCloseBtn = document.getElementById('messageCloseBtn');
        const navBar = document.getElementById('navBar');
        const globalSearchContainer = document.getElementById('globalSearchContainer');
        const globalSearch = document.getElementById('globalSearch');
        const toggleSearchBtn = document.getElementById('toggleSearchBtn');
        const navStatus = document.getElementById('navStatus');

        // Drag and drop functionality
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // Clear button
        clearBtn.addEventListener('click', clearData);

        // Search functionality
        cashCowsSearch.addEventListener('input', () => filterTable('cashCows'));
        lagerGuldSearch.addEventListener('input', () => filterTable('lagerGuld'));
        tabsSearch.addEventListener('input', () => filterTable('tabs'));

        // Export functionality
        exportCashCowsBtn.addEventListener('click', () => exportToCSV('cashCows'));
        exportLagerGuldBtn.addEventListener('click', () => exportToCSV('lagerGuld'));
        exportTabsBtn.addEventListener('click', () => exportToCSV('tabs'));

        // Advanced filters functionality
        const filterInputs = [minLagerantal, maxLagerantal, minFortjeneste, maxFortjeneste, productCategory];
        filterInputs.forEach(input => {
            input.addEventListener('input', applyFilters);
            input.addEventListener('change', applyFilters);
        });

        resetFiltersBtn.addEventListener('click', resetFilters);

        // Print functionality
        printBtn.addEventListener('click', () => window.print());

        // Favorites functionality
        clearFavoritesBtn.addEventListener('click', clearAllFavorites);

        // Message modal functionality
        messageCloseBtn.addEventListener('click', hideMessageModal);
        messageModal.addEventListener('click', (e) => {
            if (e.target === messageModal) {
                hideMessageModal();
            }
        });

        // Navigation functionality
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = link.getAttribute('data-section');
                scrollToSection(sectionId);

                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('text-blue-600', 'bg-blue-50'));
                link.classList.add('text-blue-600', 'bg-blue-50');
            });
        });

        // Global search functionality
        toggleSearchBtn.addEventListener('click', toggleGlobalSearch);
        globalSearch.addEventListener('input', performGlobalSearch);
        globalSearch.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideGlobalSearch();
            }
        });

        // Comparison mode functionality
        compareBtn.addEventListener('click', enterComparisonMode);
        exitCompareBtn.addEventListener('click', exitComparisonMode);
        file1Input.addEventListener('change', (e) => handleComparisonFile(e.target.files[0], 1));
        file2Input.addEventListener('change', (e) => handleComparisonFile(e.target.files[0], 2));

        // Drag and drop for comparison files
        file1DropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            file1DropZone.classList.add('dragover');
        });
        file1DropZone.addEventListener('dragleave', () => {
            file1DropZone.classList.remove('dragover');
        });
        file1DropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            file1DropZone.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                handleComparisonFile(e.dataTransfer.files[0], 1);
            }
        });

        file2DropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            file2DropZone.classList.add('dragover');
        });
        file2DropZone.addEventListener('dragleave', () => {
            file2DropZone.classList.remove('dragover');
        });
        file2DropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            file2DropZone.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                handleComparisonFile(e.dataTransfer.files[0], 2);
            }
        });

        // Message modal functions
        function showMessageModal(type, title, message) {
            messageTitle.textContent = title;
            messageText.textContent = message;

            // Set icon based on type
            const icons = {
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                success: '‚úÖ',
                info: '‚ÑπÔ∏è'
            };

            messageIcon.innerHTML = `<span class="text-2xl">${icons[type] || icons.info}</span>`;

            // Set modal class for styling
            messageModal.className = `fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 message-modal-${type}`;

            messageModal.classList.remove('hidden');
        }

        function hideMessageModal() {
            messageModal.classList.add('hidden');
        }

        // Navigation and search functions
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function toggleGlobalSearch() {
            const isVisible = !globalSearchContainer.classList.contains('hidden');
            if (isVisible) {
                hideGlobalSearch();
            } else {
                showGlobalSearch();
            }
        }

        function showGlobalSearch() {
            globalSearchContainer.classList.remove('hidden');
            globalSearch.focus();
            globalSearch.value = '';
            clearGlobalSearchHighlights();
        }

        function hideGlobalSearch() {
            globalSearchContainer.classList.add('hidden');
            globalSearch.value = '';
            clearGlobalSearchHighlights();
        }

        function performGlobalSearch() {
            const searchTerm = globalSearch.value.toLowerCase().trim();
            clearGlobalSearchHighlights();

            if (searchTerm.length < 2) {
                navStatus.textContent = '';
                return;
            }

            let totalMatches = 0;

            // Search in all product data
            const allProducts = [...salesData];
            const matchingProducts = allProducts.filter(product =>
                product.varenavn.toLowerCase().includes(searchTerm) ||
                (product.varekode && product.varekode.toLowerCase().includes(searchTerm))
            );

            totalMatches = matchingProducts.length;

            // Update status
            navStatus.textContent = totalMatches > 0 ?
                `Fundet ${totalMatches} produkt${totalMatches === 1 ? '' : 'er'}` :
                'Ingen resultater';

            // Highlight matching sections if we have results
            if (totalMatches > 0) {
                highlightMatchingSections(matchingProducts);
            }
        }

        function highlightMatchingSections(products) {
            // Group products by their sections
            const sections = {
                cashCows: products.filter(p => cashCowsData.some(c => c.varenavn === p.varenavn)),
                lagerGuld: products.filter(p => lagerGuldData.some(l => l.varenavn === p.varenavn)),
                tabs: products.filter(p => tabsData.some(t => t.varenavn === p.varenavn)),
                favorites: products.filter(p => favorites.has(p.varenavn))
            };

            // Highlight nav links for sections with matches
            document.querySelectorAll('.nav-link').forEach(link => {
                const section = link.getAttribute('data-section');
                const hasMatches = sections[section] && sections[section].length > 0;

                if (hasMatches) {
                    link.classList.add('bg-yellow-50', 'text-yellow-700', 'font-semibold');
                } else {
                    link.classList.remove('bg-yellow-50', 'text-yellow-700', 'font-semibold');
                }
            });
        }

        function clearGlobalSearchHighlights() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('bg-yellow-50', 'text-yellow-700', 'font-semibold');
            });
        }

        function updateNavigationVisibility() {
            const favoritesLink = document.querySelector('[data-section="favorites"]');
            if (favorites.size > 0) {
                favoritesLink.classList.remove('hidden');
            } else {
                favoritesLink.classList.add('hidden');
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Handle file upload
        function handleFile(file) {
            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                showMessageModal('error', 'Ugyldig filtype', 'V√¶lg venligst en CSV-fil (.csv)');
                return;
            }

            showLoading('L√¶ser CSV-fil...');

            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    setTimeout(() => {
                        processData(results.data);
                    }, 200);
                },
                error: function(error) {
                    console.error('Error parsing CSV:', error);
                    showMessageModal('error', 'Fejl ved l√¶sning', 'Kunne ikke l√¶se CSV-filen. Kontroller at filen er gyldig og pr√∏v igen.');
                    hideLoading();
                }
            });
        }

        // Show loading overlay
        function showLoading(message = 'Behandler data...') {
            document.getElementById('loadingMessage').textContent = message;
            document.getElementById('progressText').textContent = '0%';
            loadingOverlay.classList.remove('hidden');
            progressFill.style.width = '0%';
        }

        // Hide loading overlay
        function hideLoading() {
            loadingOverlay.classList.add('hidden');
            progressFill.style.width = '100%';
        }

        // Update progress with message
        function updateProgress(percentage, message = null) {
            progressFill.style.width = percentage + '%';
            document.getElementById('progressText').textContent = percentage + '%';

            if (message) {
                document.getElementById('loadingMessage').textContent = message;
            }
        }

        // Process and clean data
        function processData(rawData) {
            updateProgress(10, 'Filtrerer ugyldige data...');

            // Filter data
            const filteredData = rawData.filter(row => {
                const udprisValue = row['Udpris'] || row['udpris'] || '';
                return udprisValue && udprisValue !== '99999' && udprisValue !== '9999' && udprisValue !== '';
            });

            updateProgress(30, 'Beregner fortjeneste og oms√¶tning...');

            // Process data
            salesData = filteredData.map(row => {
                const udpris = parseDanishNumber(row['Udpris'] || row['udpris'] || '0');
                const gnskost = parseDanishNumber(row['GnSKost'] || row['GnsKost'] || row['gnskost'] || '0');
                const dispBeh = parseInt(row['Disp.beh'] || row['disp.beh'] || '0');
                const varenavn = row['Varenavn'] || row['Varetekst.'] || row['varenavn'] || row['Varetekst'] || 'Ukendt produkt';

                const reelOmsaetning = udpris / 1.25;
                const reelFortjeneste = reelOmsaetning - gnskost;

                const varekode = row['Varenr'] || row['Varenummer'] || row['Artikelnummer'] || row['EAN'] || row['Produktnr'] || row['SKU'] || row['varenr'] || row['varenummer'] || '';

                // Udtr√¶k kategori fra varenavn hvis varekode er 'Sum'
                let kategori = '';
                if (varekode === 'Sum' && varenavn.startsWith('Sum: ')) {
                    // Format: "Sum: Kategori, Underkategori" - udtr√¶k "Kategori, Underkategori"
                    const sumMatch = varenavn.match(/^Sum:\s*(.+)$/);
                    if (sumMatch) {
                        kategori = sumMatch[1].trim();
                    }
                }

                return {
                    varenavn: varenavn,
                    varekode: varekode,
                    kategori: kategori,
                    lagerantal: dispBeh,
                    udpris: udpris,
                    gnskost: gnskost,
                    reelOmsaetning: reelOmsaetning,
                    reelFortjeneste: reelFortjeneste
                };
            }).filter(item => !isNaN(item.reelFortjeneste));

            updateProgress(50, 'Analyserer produktkategorier...');

            // Initialize filtered data
            filteredSalesData = [...salesData];

            updateProgress(70, 'Genererer oversigter...');

            displayDashboard();

            updateProgress(90, 'Gemmer data lokalt...');

            // Save to localStorage
            saveToLocalStorage(salesData, 'uploaded-file.csv');

            updateProgress(100, 'F√¶rdig!');
            setTimeout(() => hideLoading(), 300);
        }

        // Parse Danish number format
        function parseDanishNumber(str) {
            if (!str) return 0;
            // Replace dots with nothing, commas with dots
            const cleaned = str.toString().replace(/\./g, '').replace(',', '.');
            return parseFloat(cleaned) || 0;
        }

        // Display dashboard
        function displayDashboard() {
            // Hide upload zone, show dashboard and clear button
            uploadZone.classList.add('hidden');
            dashboard.classList.remove('hidden');
            navBar.classList.remove('hidden');
            clearBtn.classList.remove('hidden');

            // Populate tables
            populateCashCows();
            populateLagerGuld();
            populateTabsListen();

            // Update statistics
            updateStatistics();

            // Apply initial filters
            applyFilters();

            // Update charts
            updateCharts();

            // Update favorites section and navigation
            updateFavoritesSection();
            updateNavigationVisibility();

            // Show print button
            printBtn.classList.remove('hidden');
        }

        // Populate Cash Cows table (Top 10 profit)
        function populateCashCows() {
            const top10 = filteredSalesData
                .sort((a, b) => b.reelFortjeneste - a.reelFortjeneste)
                .slice(0, 10);

            cashCowsData = top10;
            renderTable('cashCows', top10);
        }

        // Populate Lager-Guld table (High inventory, good profit)
        function populateLagerGuld() {
            const filtered = filteredSalesData
                .filter(item => item.lagerantal > 10 && item.reelFortjeneste > 50)
                .sort((a, b) => b.lagerantal - a.lagerantal);

            lagerGuldData = filtered;
            renderTable('lagerGuld', filtered);
        }

        // Populate Tabs-listen table (Negative profit)
        function populateTabsListen() {
            const filtered = filteredSalesData
                .filter(item => item.reelFortjeneste < 0)
                .sort((a, b) => a.reelFortjeneste - b.reelFortjeneste); // Most negative first

            tabsData = filtered;
            renderTable('tabs', filtered);
        }

        // Update statistics overview
        function updateStatistics() {
            const totalProducts = filteredSalesData.length;
            const totalProfit = filteredSalesData.reduce((sum, item) => sum + item.reelFortjeneste, 0);
            const avgProfit = totalProducts > 0 ? totalProfit / totalProducts : 0;
            const lossProducts = filteredSalesData.filter(item => item.reelFortjeneste < 0).length;

            totalProductsEl.textContent = totalProducts.toLocaleString('da-DK');
            totalProfitEl.textContent = formatCurrency(totalProfit);
            avgProfitEl.textContent = formatCurrency(avgProfit);
            lossProductsEl.textContent = lossProducts.toLocaleString('da-DK');
        }

        // Create and update charts
        function updateCharts() {
            updateProfitChart();
            updateInventoryChart();
        }

        // Update profit distribution chart
        function updateProfitChart() {
            const profitRanges = {
                'Tabsgivende (< 0 kr)': filteredSalesData.filter(item => item.reelFortjeneste < 0).length,
                'Lav fortjeneste (0-50 kr)': filteredSalesData.filter(item => item.reelFortjeneste >= 0 && item.reelFortjeneste < 50).length,
                'Middel fortjeneste (50-200 kr)': filteredSalesData.filter(item => item.reelFortjeneste >= 50 && item.reelFortjeneste < 200).length,
                'H√∏j fortjeneste (200+ kr)': filteredSalesData.filter(item => item.reelFortjeneste >= 200).length
            };

            if (profitChart) {
                profitChart.destroy();
            }

            profitChart = new Chart(profitChartCanvas, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(profitRanges),
                    datasets: [{
                        data: Object.values(profitRanges),
                        backgroundColor: [
                            '#ef4444', // red
                            '#f59e0b', // yellow
                            '#3b82f6', // blue
                            '#10b981'  // green
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ' + context.parsed + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update inventory status chart
        function updateInventoryChart() {
            const inventoryRanges = {
                'Udsolgt (0 stk)': filteredSalesData.filter(item => item.lagerantal === 0).length,
                'Lav lager (1-5 stk)': filteredSalesData.filter(item => item.lagerantal >= 1 && item.lagerantal <= 5).length,
                'Middel lager (6-20 stk)': filteredSalesData.filter(item => item.lagerantal >= 6 && item.lagerantal <= 20).length,
                'H√∏j lager (21+ stk)': filteredSalesData.filter(item => item.lagerantal >= 21).length
            };

            if (inventoryChart) {
                inventoryChart.destroy();
            }

            inventoryChart = new Chart(inventoryChartCanvas, {
                type: 'bar',
                data: {
                    labels: Object.keys(inventoryRanges),
                    datasets: [{
                        label: 'Antal produkter',
                        data: Object.values(inventoryRanges),
                        backgroundColor: [
                            '#ef4444', // red
                            '#f59e0b', // yellow
                            '#3b82f6', // blue
                            '#10b981'  // green
                        ],
                        borderWidth: 1,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Apply advanced filters
        function applyFilters() {
            filteredSalesData = [...salesData];

            // Filter by lagerantal
            const minLager = parseInt(minLagerantal.value) || 0;
            const maxLager = parseInt(maxLagerantal.value) || Infinity;
            if (minLager > 0 || maxLager < Infinity) {
                filteredSalesData = filteredSalesData.filter(item =>
                    item.lagerantal >= minLager && item.lagerantal <= maxLager
                );
            }

            // Filter by fortjeneste
            const minProfit = parseFloat(minFortjeneste.value) || -Infinity;
            const maxProfit = parseFloat(maxFortjeneste.value) || Infinity;
            if (minProfit > -Infinity || maxProfit < Infinity) {
                filteredSalesData = filteredSalesData.filter(item =>
                    item.reelFortjeneste >= minProfit && item.reelFortjeneste <= maxProfit
                );
            }

            // Filter by category
            const category = productCategory.value;
            if (category) {
                const categoryKeywords = {
                    'mad': ['mad', 'drikke', '√∏l', 'vin', 'cola', 'kaffe', 'te', 'chokolade', 'slik', 'kage'],
                    'elektronik': ['telefon', 'computer', 'tv', 'radio', 'kabel', 'lad', 'batteri', 'sk√¶rm'],
                    'toj': ['bukser', 'skjorte', 'sko', 'hat', 'taske', 't√∏j', 'jakke', 'tr√∏je'],
                    'husholdning': ['rens', 'vask', 'k√∏kken', 'bad', 'toilet', 'st√∏vsug', 'komfur'],
                    'andre': []
                };

                const keywords = categoryKeywords[category] || [];
                if (keywords.length > 0) {
                    filteredSalesData = filteredSalesData.filter(item => {
                        // Brug kategori-feltet hvis det er udfyldt (fra Sum varer)
                        if (item.kategori) {
                            return keywords.some(keyword =>
                                item.kategori.toLowerCase().includes(keyword.toLowerCase())
                            );
                        }
                        // Ellers brug varenavn som f√∏r
                        return keywords.some(keyword =>
                            item.varenavn.toLowerCase().includes(keyword.toLowerCase())
                        );
                    });
                }
            }

            // Repopulate all tables with filtered data
            populateCashCows();
            populateLagerGuld();
            populateTabsListen();
            updateStatistics();
            updateCharts();
        }

        // Reset all filters
        function resetFilters() {
            minLagerantal.value = '';
            maxLagerantal.value = '';
            minFortjeneste.value = '';
            maxFortjeneste.value = '';
            productCategory.value = '';

            filteredSalesData = [...salesData];
            populateCashCows();
            populateLagerGuld();
            populateTabsListen();
            updateStatistics();
            updateCharts();
        }

        // Enter comparison mode
        function enterComparisonMode() {
            isComparisonMode = true;
            dashboard.classList.add('hidden');
            navBar.classList.add('hidden');
            comparisonMode.classList.remove('hidden');
            compareBtn.classList.add('hidden');
            clearBtn.classList.add('hidden');

            // Reset comparison data
            file1Data = [];
            file2Data = [];
            file1Stats.classList.add('hidden');
            file2Stats.classList.add('hidden');
            comparisonResults.classList.add('hidden');
        }

        // Exit comparison mode
        function exitComparisonMode() {
            isComparisonMode = false;
            comparisonMode.classList.add('hidden');
            dashboard.classList.remove('hidden');
            navBar.classList.remove('hidden');
            compareBtn.classList.remove('hidden');
            if (salesData.length > 0) {
                clearBtn.classList.remove('hidden');
            }
        }

        // Handle comparison file upload
        function handleComparisonFile(file, fileNumber) {
            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                showMessageModal('error', 'Ugyldig filtype', 'V√¶lg venligst en CSV-fil (.csv)');
                return;
            }

            showLoading();

            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    const processedData = processComparisonData(results.data);
                    if (fileNumber === 1) {
                        file1Data = processedData;
                        updateFile1Stats();
                    } else {
                        file2Data = processedData;
                        updateFile2Stats();
                    }

                    if (file1Data.length > 0 && file2Data.length > 0) {
                        performComparison();
                    }

                    hideLoading();
                },
                error: function(error) {
                    console.error('Error parsing comparison CSV:', error);
                    showMessageModal('error', 'Fejl ved l√¶sning', 'Kunne ikke l√¶se sammenligningsfilen. Kontroller at filen er gyldig og pr√∏v igen.');
                    hideLoading();
                }
            });
        }

        // Process data for comparison
        function processComparisonData(rawData) {
            return rawData
                .filter(row => {
                    const udprisValue = row['Udpris'] || row['udpris'] || '';
                    return udprisValue && udprisValue !== '99999' && udprisValue !== '9999' && udprisValue !== '';
                })
                .map(row => {
                    const udpris = parseDanishNumber(row['Udpris'] || row['udpris'] || '0');
                    const gnskost = parseDanishNumber(row['GnSKost'] || row['GnsKost'] || row['gnskost'] || '0');
                    const dispBeh = parseInt(row['Disp.beh'] || row['disp.beh'] || '0');
                    const varenavn = row['Varenavn'] || row['Varetekst.'] || row['varenavn'] || row['Varetekst'] || 'Ukendt produkt';

                    const reelOmsaetning = udpris / 1.25;
                    const reelFortjeneste = reelOmsaetning - gnskost;

                    const varekode = row['Varenr'] || row['Varenummer'] || row['Artikelnummer'] || row['EAN'] || row['Produktnr'] || row['SKU'] || row['varenr'] || row['varenummer'] || '';

                    // Udtr√¶k kategori fra varenavn hvis varekode er 'Sum'
                    let kategori = '';
                    if (varekode === 'Sum' && varenavn.startsWith('Sum: ')) {
                        // Format: "Sum: Kategori, Underkategori" - udtr√¶k "Kategori, Underkategori"
                        const sumMatch = varenavn.match(/^Sum:\s*(.+)$/);
                        if (sumMatch) {
                            kategori = sumMatch[1].trim();
                        }
                    }

                    return {
                        varenavn: varenavn,
                        varekode: varekode,
                        kategori: kategori,
                        lagerantal: dispBeh,
                        reelFortjeneste: reelFortjeneste
                    };
                })
                .filter(item => !isNaN(item.reelFortjeneste));
        }

        // Update file 1 stats
        function updateFile1Stats() {
            const totalProducts = file1Data.length;
            const totalProfit = file1Data.reduce((sum, item) => sum + item.reelFortjeneste, 0);
            const cashCowsCount = file1Data
                .sort((a, b) => b.reelFortjeneste - a.reelFortjeneste)
                .slice(0, 10)
                .filter(item => item.reelFortjeneste > 0).length;

            file1Products.textContent = totalProducts.toLocaleString('da-DK');
            file1Profit.textContent = formatCurrency(totalProfit);
            file1CashCows.textContent = cashCowsCount;
            file1Stats.classList.remove('hidden');
        }

        // Update file 2 stats
        function updateFile2Stats() {
            const totalProducts = file2Data.length;
            const totalProfit = file2Data.reduce((sum, item) => sum + item.reelFortjeneste, 0);
            const cashCowsCount = file2Data
                .sort((a, b) => b.reelFortjeneste - a.reelFortjeneste)
                .slice(0, 10)
                .filter(item => item.reelFortjeneste > 0).length;

            file2Products.textContent = totalProducts.toLocaleString('da-DK');
            file2Profit.textContent = formatCurrency(totalProfit);
            file2CashCows.textContent = cashCowsCount;
            file2Stats.classList.remove('hidden');
        }

        // Perform comparison analysis
        function performComparison() {
            const file1Profit = file1Data.reduce((sum, item) => sum + item.reelFortjeneste, 0);
            const file2Profit = file2Data.reduce((sum, item) => sum + item.reelFortjeneste, 0);
            const profitDiff = file2Profit - file1Profit;

            // Find new products (in file2 but not in file1)
            const file1Names = new Set(file1Data.map(item => item.varenavn.toLowerCase()));
            const newProductsCount = file2Data.filter(item =>
                !file1Names.has(item.varenavn.toLowerCase())
            ).length;

            // Find improved products (better profit in file2)
            const file1Map = new Map(file1Data.map(item => [item.varenavn.toLowerCase(), item.reelFortjeneste]));
            const improvedCount = file2Data.filter(item => {
                const file1Profit = file1Map.get(item.varenavn.toLowerCase());
                return file1Profit !== undefined && item.reelFortjeneste > file1Profit;
            }).length;

            profitDifference.textContent = formatCurrency(profitDiff);
            profitDifference.className = profitDiff >= 0 ? 'text-xl font-bold text-green-900' : 'text-xl font-bold text-red-900';

            newProducts.textContent = newProductsCount;
            improvedProducts.textContent = improvedCount;

            comparisonResults.classList.remove('hidden');
        }

        // Local storage functions
        function saveToLocalStorage(data, fileName) {
            try {
                localStorage.setItem(STORAGE_KEYS.SALES_DATA, JSON.stringify(data));
                localStorage.setItem(STORAGE_KEYS.FILTERED_DATA, JSON.stringify(data));
                localStorage.setItem(STORAGE_KEYS.FILE_NAME, fileName || 'tele.csv');
                localStorage.setItem(STORAGE_KEYS.LAST_UPDATED, new Date().toISOString());

                // Show success message
                showStorageMessage('Data gemt lokalt - du kan genindl√¶se siden uden at uploade igen', 'success');
            } catch (error) {
                console.warn('Kunne ikke gemme til localStorage:', error);
                showStorageMessage('Kunne ikke gemme data lokalt', 'error');
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEYS.SALES_DATA);
                const savedFilteredData = localStorage.getItem(STORAGE_KEYS.FILTERED_DATA);
                const fileName = localStorage.getItem(STORAGE_KEYS.FILE_NAME);
                const lastUpdated = localStorage.getItem(STORAGE_KEYS.LAST_UPDATED);

                if (savedData && savedFilteredData) {
                    salesData = JSON.parse(savedData);
                    filteredSalesData = JSON.parse(savedFilteredData);

                    // Update UI to show loaded data
                    displayDashboard();

                    // Show loaded message
                    const date = lastUpdated ? new Date(lastUpdated).toLocaleString('da-DK') : 'ukendt';
                    showStorageMessage(`Data indl√¶st fra ${date} (${fileName || 'tele.csv'})`, 'info');

                    return true;
                }
            } catch (error) {
                console.warn('Kunne ikke indl√¶se fra localStorage:', error);
            }
            return false;
        }

        function clearLocalStorage() {
            Object.values(STORAGE_KEYS).forEach(key => {
                localStorage.removeItem(key);
            });
        }

        function showStorageMessage(message, type) {
            // Create temporary message element
            const messageEl = document.createElement('div');
            messageEl.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-sm font-medium z-50 ${
                type === 'success' ? 'bg-green-100 text-green-800' :
                type === 'error' ? 'bg-red-100 text-red-800' :
                'bg-blue-100 text-blue-800'
            }`;
            messageEl.textContent = message;

            document.body.appendChild(messageEl);

            // Remove after 3 seconds
            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.parentNode.removeChild(messageEl);
                }
            }, 3000);
        }

        // Favorites functions
        function toggleFavorite(productName) {
            if (favorites.has(productName)) {
                favorites.delete(productName);
            } else {
                favorites.add(productName);
            }

            // Save to localStorage
            saveFavoritesToStorage();

            // Update all tables to reflect favorite status
            populateCashCows();
            populateLagerGuld();
            populateTabsListen();

            // Update favorites section
            updateFavoritesSection();
        }

        function saveFavoritesToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify([...favorites]));
            } catch (error) {
                console.warn('Kunne ikke gemme favoritter:', error);
            }
        }

        function loadFavoritesFromStorage() {
            try {
                const savedFavorites = localStorage.getItem(STORAGE_KEYS.FAVORITES);
                if (savedFavorites) {
                    favorites = new Set(JSON.parse(savedFavorites));
                }
            } catch (error) {
                console.warn('Kunne ikke indl√¶se favoritter:', error);
                favorites = new Set();
            }
        }

        function updateFavoritesSection() {
            if (favorites.size === 0) {
                favoritesSection.classList.add('hidden');
                return;
            }

            favoritesSection.classList.remove('hidden');

            // Get favorite products from current data
            const favoriteProducts = salesData.filter(item => favorites.has(item.varenavn));

            favoritesTable.innerHTML = '';

            if (favoriteProducts.length === 0) {
                favoritesTable.innerHTML = generateEmptyState('favorites');
                return;
            }

            favoriteProducts.forEach(item => {
                const row = document.createElement('tr');
                const profitClass = item.reelFortjeneste >= 0 ? 'profit-positive' : 'profit-negative';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-700">${item.varekode || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.varenavn}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.lagerantal}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${profitClass}">${formatCurrency(item.reelFortjeneste)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="toggleFavorite('${item.varenavn.replace(/'/g, "\\'")}')" class="text-red-500 hover:text-red-700 transition-colors" title="Fjern fra favoritter">
                            üóëÔ∏è
                        </button>
                    </td>
                `;
                favoritesTable.appendChild(row);
            });
        }

        function clearAllFavorites() {
            favorites.clear();
            saveFavoritesToStorage();
            updateFavoritesSection();
            populateCashCows();
            populateLagerGuld();
            populateTabsListen();
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('da-DK', {
                style: 'currency',
                currency: 'DKK'
            }).format(amount);
        }

        // Generate empty state HTML
        function generateEmptyState(tableType) {
            const emptyStates = {
                cashCows: {
                    icon: 'üêÑ',
                    title: 'Ingen Cash Cows fundet',
                    description: 'Produkter med h√∏j fortjeneste vil blive vist her. Pr√∏v at justere filtrene eller upload flere data.'
                },
                lagerGuld: {
                    icon: 'üì¶',
                    title: 'Intet Lager-Guld fundet',
                    description: 'Produkter med h√∏jt lager og god fortjeneste vil blive vist her. Pr√∏v at justere filtrene.'
                },
                tabs: {
                    icon: '‚ö†Ô∏è',
                    title: 'Ingen tabsgivende produkter',
                    description: 'Tabsgivende produkter vil blive vist her. Det ser ud til at alle produkter er profitable!'
                },
                favorites: {
                    icon: '‚≠ê',
                    title: 'Ingen favorit produkter',
                    description: 'Klik p√• stjernen ved produkter du vil f√∏lge med i for at tilf√∏je dem til favoritter.'
                }
            };

            const state = emptyStates[tableType] || emptyStates.cashCows;

            return `
                <div class="empty-state">
                    <div class="empty-state-icon">${state.icon}</div>
                    <div class="empty-state-title">${state.title}</div>
                    <div class="empty-state-description">${state.description}</div>
                </div>
            `;
        }

        // Render table with data
        function renderTable(tableType, data) {
            let tableElement;
            let profitClass;

            switch(tableType) {
                case 'cashCows':
                    tableElement = cashCowsTable;
                    profitClass = 'profit-positive';
                    break;
                case 'lagerGuld':
                    tableElement = lagerGuldTable;
                    profitClass = 'profit-positive';
                    break;
                case 'tabs':
                    tableElement = tabsTable;
                    profitClass = 'profit-negative';
                    break;
            }

            tableElement.innerHTML = '';

            if (data.length === 0) {
                tableElement.innerHTML = generateEmptyState(tableType);
                return;
            }

            data.forEach(item => {
                const row = document.createElement('tr');
                const isFavorite = favorites.has(item.varenavn);
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-700">${item.varekode || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.varenavn}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.lagerantal}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${profitClass}">${formatCurrency(item.reelFortjeneste)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="toggleFavorite('${item.varenavn.replace(/'/g, "\\'")}')" class="text-yellow-500 hover:text-yellow-700 transition-colors" title="${isFavorite ? 'Fjern fra favoritter' : 'Tilf√∏j til favoritter'}">
                            ${isFavorite ? '‚≠ê' : '‚òÜ'}
                        </button>
                    </td>
                `;
                tableElement.appendChild(row);
            });
        }

        // Filter table based on search input
        function filterTable(tableType) {
            let searchInput, data, tableElement, profitClass;

            switch(tableType) {
                case 'cashCows':
                    searchInput = cashCowsSearch;
                    data = cashCowsData;
                    tableElement = cashCowsTable;
                    profitClass = 'profit-positive';
                    break;
                case 'lagerGuld':
                    searchInput = lagerGuldSearch;
                    data = lagerGuldData;
                    tableElement = lagerGuldTable;
                    profitClass = 'profit-positive';
                    break;
                case 'tabs':
                    searchInput = tabsSearch;
                    data = tabsData;
                    tableElement = tabsTable;
                    profitClass = 'profit-negative';
                    break;
            }

            const searchTerm = searchInput.value.toLowerCase();

            if (searchTerm === '') {
                renderTable(tableType, data);
                return;
            }

            const filteredData = data.filter(item =>
                item.varenavn.toLowerCase().includes(searchTerm) ||
                (item.varekode && item.varekode.toLowerCase().includes(searchTerm))
            );

            renderTable(tableType, filteredData);
        }

        // Export table data to CSV
        function exportToCSV(tableType) {
            let data, filename;

            switch(tableType) {
                case 'cashCows':
                    data = cashCowsData;
                    filename = 'cash-cows-fortjeneste.csv';
                    break;
                case 'lagerGuld':
                    data = lagerGuldData;
                    filename = 'lager-guld-saalg-nu.csv';
                    break;
                case 'tabs':
                    data = tabsData;
                    filename = 'tabs-listen-pas-paa.csv';
                    break;
            }

            if (data.length === 0) {
                showMessageModal('warning', 'Ingen data', 'Der er ingen data at eksportere i denne kategori.');
                return;
            }

            // Create CSV content
            const headers = ['Varekode', 'Varenavn', 'Lagerantal', 'Fortjeneste'];
            const csvContent = [
                headers.join(','),
                ...data.map(item => [
                    `"${(item.varekode || '').replace(/"/g, '""')}"`, // Escape quotes
                    `"${item.varenavn.replace(/"/g, '""')}"`, // Escape quotes
                    item.lagerantal,
                    item.reelFortjeneste.toFixed(2).replace('.', ',') // Danish number format
                ].join(','))
            ].join('\n');

            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Clear data and reset UI
        function clearData() {
            salesData = [];
            filteredSalesData = [];
            cashCowsData = [];
            lagerGuldData = [];
            tabsData = [];
            uploadZone.classList.remove('hidden');
            dashboard.classList.add('hidden');
            navBar.classList.add('hidden');
            clearBtn.classList.add('hidden');
            fileInput.value = '';

            // Clear search inputs
            cashCowsSearch.value = '';
            lagerGuldSearch.value = '';
            tabsSearch.value = '';
            hideGlobalSearch();

            // Hide print button
            printBtn.classList.add('hidden');

            // Clear local storage
            clearLocalStorage();

            // Clear favorites
            clearAllFavorites();

            // Reset filters
            resetFilters();
        }

        // Initialize app - load from localStorage if available
        function initializeApp() {
            loadFavoritesFromStorage();
            const dataLoaded = loadFromLocalStorage();
            if (!dataLoaded) {
                // Show upload zone if no data was loaded
                uploadZone.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>>